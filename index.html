<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SUSHI „É°</title>
<link rel="stylesheet" href="style.css">
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Jost:wght@500;600&display=swap" rel="stylesheet">


<!-- Open Graph –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π -->
<meta property="og:title" content="SUSHI „É°" />
<meta property="og:image" content="https://sushix0.github.io/SUSHI-X/Foto/Logo.png" />
<meta property="og:type" content="website" />
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DM67PTW8TB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DM67PTW8TB');
</script>

<body>


<div class="wrap">
  <header class="brand">
    <!-- –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ª–æ–≥–æ—Ç–∏–ø -->
    <h1 class="logo"><span>SUSHI</span> <span class="jp">„É°</span></h1>

<div class="lang-switcher">
  <a href="" class="lang-btn active">ET</a>
  <a href="ru/" class="lang-btn">RU</a>
  <a href="en/" class="lang-btn">EN</a>
</div>

  </header>
  <div class="note-orders-disabled" id="orders-disabled-note" style="display:none;">NB! –ó–∞–∫–∞–∑—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è</div>




<!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞—Ä -->
<div class="menu-filters" id="menuFilters">
  <button>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</button>
  <button>–£—Ä–∞–º–∞–∫–∏</button>
  <button>–§—É—Ç–æ–º–∞–∫–∏</button>
  <button>–ú–∞–∫–∏</button>
  <button>–¢–µ–º–ø—É—Ä–∞</button>
  <button>–ó–∞–ø–µ—á—ë–Ω–Ω—ã–µ</button>
  <button>–ù–∏–≥–∏—Ä–∏</button>
  <button>–ù–∞–±–æ—Ä—ã</button>
  <button>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</button>
  <button data-action="contacts">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
</div>

<!-- –ü–ª–∞–≤–∞—é—â–∏–π –±–∞—Ä -->
<div class="menu-filters-floating" id="menuFiltersFloating">
  <button>–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</button>
  <button>–£—Ä–∞–º–∞–∫–∏</button>
  <button>–§—É—Ç–æ–º–∞–∫–∏</button>
  <button>–ú–∞–∫–∏</button>
  <button>–¢–µ–º–ø—É—Ä–∞</button>
  <button>–ó–∞–ø–µ—á—ë–Ω–Ω—ã–µ</button>
  <button>–ù–∏–≥–∏—Ä–∏</button>
  <button>–ù–∞–±–æ—Ä—ã</button>
  <button>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</button>
  <button data-action="contacts">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</button>
</div>


  <main>

<section class="menu-section" id="specialOffers">
  <h2 class="section-title">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h2>
  <div class="grid"></div>
</section>

  <!-- –†–∞–∑–¥–µ–ª: –£—Ä–∞–º–∞–∫–∏ -->
  <section class="menu-section">
    <h2 class="section-title">–£—Ä–∞–º–∞–∫–∏</h2>
    <div class="grid">
      <article class="card" data-id="—Ñ–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è">
        <div class="photo" style="background-image:url('Foto/Shushi-1.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è</span><span class="label-jp"><span class="scroll-text">„Éï„Ç£„É©„Éá„É´„Éï„Ç£„Ç¢</span></span></h3>
          <p class="ingredients">–õ–æ—Å–æ—Å—å ¬∑ Philadelphia ¬∑ –û–≥—É—Ä–µ—Ü ¬∑ –ê–≤–æ–∫–∞–¥–æ</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>

      <article class="card" data-id="—Å–Ω–µ–∂–Ω—ã–π_–∫—Ä–∞–±">
        <div class="photo" style="background-image:url('Foto/Shushi-10.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–°–Ω–µ–∂–Ω—ã–π –∫—Ä–∞–±</span><span class="label-jp"><span class="scroll-text">„Çπ„Éé„Éº„ÇØ„É©„Éñ</span></span></h3>
          <p class="ingredients">–°–Ω–µ–∂–Ω—ã–π –∫—Ä–∞–± ¬∑ Philadelphia ¬∑ –û–≥—É—Ä–µ—Ü</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>

      <article class="card" data-id="–∫–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è">
        <div class="photo" style="background-image:url('Foto/Shushi-11.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–ö–∞–ª–∏—Ñ–æ—Ä–Ω–∏—è</span><span class="label-jp"><span class="scroll-text">„Ç´„É™„Éï„Ç©„É´„Éã„Ç¢</span></span></h3>
          <p class="ingredients">–°–Ω–µ–∂–Ω—ã–π –∫—Ä–∞–± ¬∑ Philadelphia ¬∑ –û–≥—É—Ä–µ—Ü ¬∑ –ú–∞—Å–∞–≥–æ</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>

      <article class="card" data-id="–∞–ª—è—Å–∫–∞">
        <div class="photo" style="background-image:url('Foto/Shushi-8.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–ê–ª—è—Å–∫–∞</span><span class="label-jp"><span class="scroll-text">„Ç¢„É©„Çπ„Ç´</span></span></h3>
          <p class="ingredients">–£–≥–æ—Ä—å ¬∑ –õ–æ—Å–æ—Å—å ¬∑ Philadelphia ¬∑ –ê–≤–æ–∫–∞–¥–æ</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>
    </div>
  </section>

  <!-- –†–∞–∑–¥–µ–ª: –§—É—Ç–æ–º–∞–∫–∏ -->
  <section class="menu-section">
    <h2 class="section-title">–§—É—Ç–æ–º–∞–∫–∏</h2>
    <div class="grid">
      <article class="card" data-id="—Ñ—É—Ç–æ–º–∞–∫–∏_—Å_–∫—Ä–∞–±–æ–º">
        <div class="photo" style="background-image:url('Foto/Shushi-4.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–§—É—Ç–æ–º–∞–∫–∏ —Å –ö—Ä–∞–±–æ–º</span><span class="label-jp"><span class="scroll-text">„ÇØ„É©„ÉñÂ§™Â∑ª„Åç</span></span></h3>
          <p class="ingredients">–û–≥—É—Ä–µ—Ü ¬∑ –ê–≤–æ–∫–∞–¥–æ ¬∑ –°—ã—Ä Philadelphia ¬∑ –ö—Ä–∞–±–æ–≤–æ–µ –º—è—Å–æ</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>

      <article class="card" data-id="—Ñ—É—Ç–æ–º–∞–∫–∏_—Å_–∫—Ä–µ–≤–µ—Ç–∫–æ–π">
        <div class="photo" style="background-image:url('Foto/Shushi-3.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–§—É—Ç–æ–º–∞–∫–∏ —Å –∫—Ä–µ–≤–µ—Ç–∫–æ–π</span><span class="label-jp"><span class="scroll-text">„Ç®„ÉìÂ§™Â∑ª„Åç</span></span></h3>
          <p class="ingredients">–û–≥—É—Ä–µ—Ü ¬∑ –°—ã—Ä Philadelphia ¬∑ –ö—Ä–µ–≤–µ—Ç–∫–∞</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>
    </div>
  </section>

  <!-- –†–∞–∑–¥–µ–ª: –ú–∞–∫–∏ -->
  <section class="menu-section">
    <h2 class="section-title">–ú–∞–∫–∏</h2>
    <div class="grid">
      <article class="card" data-id="–º–∞–∫–∏_—Å_–æ–≥—É—Ä—Ü–æ–º">
        <div class="photo" style="background-image:url('Foto/Shushi-7.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–ú–∞–∫–∏ —Å –æ–≥—É—Ä—Ü–æ–º</span><span class="label-jp"><span class="scroll-text">„Ç≠„É•„Ç¶„É™</span></span></h3>
          <p class="ingredients">–û–≥—É—Ä–µ—Ü</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>

      <article class="card" data-id="–º–∞–∫–∏_—Å_–æ–º–ª–µ—Ç–æ–º">
        <div class="photo" style="background-image:url('Foto/Shushi-6.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–ú–∞–∫–∏ —Å –æ–º–ª–µ—Ç–æ–º</span><span class="label-jp"><span class="scroll-text">ÁéâÂ≠êÂ∑ª</span></span></h3>
          <p class="ingredients">–Ø–ø–æ–Ω—Å–∫–∏–π –æ–º–ª–µ—Ç</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>
    </div>
  </section>

  <!-- –†–∞–∑–¥–µ–ª: –¢–µ–º–ø—É—Ä–∞ -->
  <section class="menu-section">
    <h2 class="section-title">–¢–µ–º–ø—É—Ä–∞</h2>
    <div class="grid">
      <article class="card" data-id="—Ç–µ–º–ø—É—Ä–∞_—Å_–∫—Ä–∞–±–æ–º">
        <div class="photo" style="background-image:url('Foto/Shushi-22.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–¢–µ–º–ø—É—Ä–∞ —Å –∫—Ä–∞–±–æ–º</span><span class="label-jp"><span class="scroll-text">„Ç´„ÉãÂ§©„Å∑„Çâ</span></span></h3>
          <p class="ingredients">–û–≥—É—Ä–µ—Ü ¬∑ –°—ã—Ä Philadelphia ¬∑ –ö—Ä–∞–±–æ–≤–æ–µ –º—è—Å–æ</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>

      <article class="card" data-id="—Ç–µ–º–ø—É—Ä–∞_—Å_–∫—É—Ä–∏—Ü–µ–π">
        <div class="photo" style="background-image:url('Foto/Shushi-13.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–¢–µ–º–ø—É—Ä–∞ —Å –∫—É—Ä–∏—Ü–µ–π</span><span class="label-jp"><span class="scroll-text">„ÉÅ„Ç≠„É≥Â§©„Å∑„Çâ</span></span></h3>
          <p class="ingredients">–û–≥—É—Ä–µ—Ü ¬∑ –ü–∞–ø—Ä–∏–∫–∞ ¬∑ –°—ã—Ä Philadelphia ¬∑ –ö—É—Ä–∏—Ü–∞</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>
    </div>
  </section>

  <!-- –†–∞–∑–¥–µ–ª: –ó–∞–ø–µ—á—ë–Ω–Ω—ã–µ -->
  <section class="menu-section">
    <h2 class="section-title">–ó–∞–ø–µ—á—ë–Ω–Ω—ã–µ</h2>
    <div class="grid">
      <article class="card" data-id="–∑–∞–ø–µ—á—ë–Ω–Ω—ã–π_—Ä–æ–ª–ª_–Ω–∏–∫–æ">
        <div class="photo" style="background-image:url('Foto/Shushi-19.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
          </div>
        <div class="body">
          <h3 class="title"><span class="name">–ó–∞–ø–µ—á—ë–Ω–Ω—ã–π –†–æ–ª–ª ¬´–ù–∏–∫–æ¬ª</span><span class="label-jp"><span class="scroll-text">„Éã„Ç≥ÁÑº„Åç„É≠„Éº„É´</span></span></h3>
          <p class="ingredients">–û–≥—É—Ä–µ—Ü ¬∑ –°—ã—Ä Philadelphia ¬∑ –õ–æ—Å–æ—Å—å, –ö—Ä–∞–±–æ–≤–æ–µ –º—è—Å–æ ¬∑ –ú–∞—Å–∞–≥–æ</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>

      <article class="card" data-id="–∑–∞–ø–µ—á—ë–Ω–Ω—ã–π_—Ä–æ–ª–ª_—Å–∞–ª–º–æ–Ω">
        <div class="photo" style="background-image:url('Foto/Shushi-18.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–ó–∞–ø–µ—á—ë–Ω–Ω—ã–π –†–æ–ª–ª ¬´–°a–ª–º–æ–Ω¬ª</span><span class="label-jp"><span class="scroll-text">„Çµ„Éº„É¢„É≥ÁÑº„Åç„É≠„Éº„É´</span></span></h3>
          <p class="ingredients">–ê–≤–æ–∫–∞–¥–æ ¬∑ –°—ã—Ä Philadelphia ¬∑ –õ–æ—Å–æ—Å—å</p>
          <div class="bottom"><div class="note">8 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>
    </div>
  </section>

  <!-- –†–∞–∑–¥–µ–ª: –ù–∏–≥–∏—Ä–∏ -->
  <section class="menu-section">
    <h2 class="section-title">–ù–∏–≥–∏—Ä–∏</h2>
    <div class="grid">
      <article class="card" data-id="–Ω–∏–≥–∏—Ä–∏_—Å_–∫—Ä–µ–≤–µ—Ç–∫–æ–π">
        <div class="photo" style="background-image:url('Foto/Shushi-27.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–ù–∏–≥–∏—Ä–∏ —Å –∫—Ä–µ–≤–µ—Ç–∫–æ–π</span><span class="label-jp"><span class="scroll-text">Êµ∑ËÄÅÊè°„Çä</span></span></h3>
          <p class="ingredients">–ö—Ä–µ–≤–µ—Ç–∫–∞</p>
          <div class="bottom"><div class="note">2 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>

      <article class="card" data-id="–Ω–∏–≥–∏—Ä–∏_—Å_—É–≥—Ä—ë–º">
        <div class="photo" style="background-image:url('Foto/Shushi-28.jpg');">
          <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
          <div class="overlay-unavailable"></div>
        </div>
        <div class="body">
          <h3 class="title"><span class="name">–ù–∏–≥–∏—Ä–∏ —Å —É–≥—Ä—ë–º</span><span class="label-jp"><span class="scroll-text">È∞ªÊè°„Çä</span></span></h3>
          <p class="ingredients">–£–≥–æ—Ä—å</p>
          <div class="bottom"><div class="note">2 —à—Ç</div><div class="price"></div></div>
        </div>
      </article>
    </div>
  </section>

  <!-- –†–∞–∑–¥–µ–ª: –ù–∞–±–æ—Ä—ã -->
<section class="menu-section">
  <h2 class="section-title">–ù–∞–±–æ—Ä—ã</h2>
  <div class="grid">
    <article class="card" data-id="–∫–ª–∞—Å—Å–∏–∫–∞">
      <div class="photo" style="background-image:url('Foto/');">
        <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
        <div class="overlay-unavailable"></div>
      </div>
      <div class="body">
        <h3 class="title"><span class="name">–ö–ª–∞—Å—Å–∏–∫–∞</span><span class="label-jp"><span class="scroll-text">„ÇØ„É©„Ç∑„ÉÉ„ÇØ</span></span></h3>
        <p class="ingredients">–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è ¬∑ –°–Ω–µ–∂–Ω—ã–π –∫—Ä–∞–± ¬∑ –ú–∞–∫–∏ —Å –æ–≥—É—Ä—Ü–æ–º</p>
        <div class="bottom"><div class="note">24 —à—Ç</div><div class="price"></div></div>
      </div>
    </article>

    <article class="card" data-id="–ø—Ä–µ–º–∏—É–º">
      <div class="photo" style="background-image:url('Foto/');">
        <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
        <div class="overlay-unavailable"></div>
      </div>
      <div class="body">
        <h3 class="title"><span class="name">–ü—Ä–µ–º–∏—É–º</span><span class="label-jp"><span class="scroll-text">„Éó„É¨„Éü„Ç¢„É†</span></span></h3>
        <p class="ingredients">–§–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è ¬∑ –ê–ª—è—Å–∫–∞ ¬∑ –ù–∏–≥–∏—Ä–∏ —Å —É–≥—Ä—ë–º ¬∑ –ù–∏–≥–∏—Ä–∏ —Å –∫—Ä–µ–≤–µ—Ç–∫–æ–π</p>
        <div class="bottom"><div class="note">20 —à—Ç</div><div class="price"></div></div>
      </div>
    </article>
  </div>
</section>

<!-- –†–∞–∑–¥–µ–ª: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ -->
<section class="menu-section">
  <h2 class="section-title">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h2>
  <div class="grid">
    <article class="card" data-id="—Å–æ–µ–≤—ã–π_—Å–æ—É—Å">
      <div class="photo" style="background-image:url('Foto/');">
        <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
        <div class="overlay-unavailable"></div>
      </div>
      <div class="body">
        <h3 class="title"><span class="name">–°–æ–µ–≤—ã–π —Å–æ—É—Å</span><span class="label-jp"><span class="scroll-text">ÈÜ§Ê≤π</span></span></h3>
        <p class="ingredients"></p>
        <div class="bottom"><div class="note">50 –º–ª</div><div class="price"></div></div>
      </div>
    </article>

    <article class="card" data-id="–∏–º–±–∏—Ä—å">
      <div class="photo" style="background-image:url('Foto/Shushi-31.jpg');">
        <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
        <div class="overlay-unavailable"></div>
      </div>
      <div class="body">
        <h3 class="title"><span class="name">–ò–º–±–∏—Ä—å</span><span class="label-jp"><span class="scroll-text">ÁîüÂßú</span></span></h3>
        <p class="ingredients"></p>
        <div class="bottom"><div class="note">50 –≥</div><div class="price"></div></div>
      </div>
    </article>

    <article class="card" data-id="–≤–∞–∫–∞–º–µ">
      <div class="photo" style="background-image:url('Foto/Shushi-30.jpg');">
        <div class="cart-icon"><img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞"></div>
        <div class="overlay-unavailable"></div>
      </div>
      <div class="body">
        <h3 class="title"><span class="name">–í–∞–∫–∞–º–µ</span><span class="label-jp"><span class="scroll-text">„ÉØ„Ç´„É°</span></span></h3>
        <p class="ingredients"></p>
        <div class="bottom"><div class="note">50 –≥</div><div class="price"></div></div>
      </div>
    </article>
  </div>
</section>



  <div class="menu-bottom-space"></div>
</main>

<footer class="site-footer" id="contacts">
  <div class="footer-divider"></div>

  <div class="footer-content">
    <div class="footer-left">
      <p><strong>SushiX O√ú</strong></p>
    </div>

    <div class="footer-center">
      <ul class="contacts-list">
        <li>–¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:+1234567890">+1 234 567 890</a></li>
        <li>Email: <a href="mailto:info@sushix.ee">info@sushix.ee</a></li>
      </ul>
    </div>

    <div class="footer-right">
      <ul class="social-list">
        <li><a href="https://www.instagram.com/sushix.eesti" target="_blank">Instagram</a></li>
        <li><a href="https://www.facebook.com/sushix.eesti" target="_blank">Facebook</a></li>
      </ul>
    </div>
  </div>

  <div class="footer-bottom">
    <p>¬© 2026 SushiX. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
  </div>
</footer>



</div>

<div class="toast" id="toast">–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É</div>
<div class="floating-cart">
  <img src="Foto/cart.png" alt="–ö–æ—Ä–∑–∏–Ω–∞">
  <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
</div>

<div id="toast" class="toast">
  <div class="toast-text"></div>
</div>



<!-- Fullscreen –∫–æ—Ä–∑–∏–Ω–∞ -->
<div id="cartFullscreen" class="cart-fullscreen" aria-hidden="true">
  <div class="cart-inner">
    <div class="cart-header">
      <h2 class="cart-title">–ö–æ—Ä–∑–∏–Ω–∞</h2>
      <div id="free-delivery-info" class="free-delivery-info"></div>

      <button id="closeCart" class="cart-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É">&times;</button>
    </div>

    <div class="cart-body">
      <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
      <div class="cart-items" role="list"></div>

      <!-- –ò—Ç–æ–≥–∏ -->
      <div class="cart-summary">
        <div class="summary-row"><span>–¢–æ–≤–∞—Ä—ã</span><span class="subtotal-price">0.00 ‚Ç¨</span></div>
        <div class="summary-row"><span>–î–æ—Å—Ç–∞–≤–∫–∞</span><span class="delivery-price">0.00 ‚Ç¨</span></div>
        <div class="summary-row"><span>–°–∫–∏–¥–∫–∞</span><span class="discount-price">0.00 ‚Ç¨</span></div>
<!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞ -->
<button id="showPromoBtn" class="btn-primary promo-toggle-btn">–í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥</button>


<!-- –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ) -->
<div class="promo-code-box" style="display:none;">
  <div class="checkout-form input"><input id="promoInput" type="text" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥"></div>
 
  
  <div class="promo-actions">
    <button id="applyPromo" class="btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    <button id="cancelPromo" class="btn-ghost">–û—Ç–º–µ–Ω–∞</button>
  </div>

  <div id="promoMessage" class="promo-message"></div>
</div>
        <div class="summary-divider"></div>
        <div class="summary-total"><span>–ò—Ç–æ–≥–æ</span><span class="total-price">0.00 ‚Ç¨</span></div>
      </div>

      <!-- –§–æ—Ä–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è -->
      <div class="checkout-card">
        <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
        <form id="checkoutForm" class="checkout-form" onsubmit="return false;">
          <input name="name" type="text" placeholder="–ò–º—è *" autocomplete="name" />
          <input name="phone" type="tel" pattern="[+\d]*" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ *" autocomplete="tel" required/>
          <input name="email" type="email" placeholder="–ü–æ—á—Ç–∞ *" autocomplete="email" />
          <select name="payment">
            <option value="" disabled selected>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã *</option>
            <option>–ù–∞–ª–∏—á–Ω—ã–µ</option>
            <option>–ö–∞—Ä—Ç–∞ –æ–Ω–ª–∞–π–Ω</option>
          </select>
          <select name="method">
            <option value="" disabled selected>–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è *</option>
            <option>–°–∞–º–æ–≤—ã–≤–æ–∑</option>
            <option>–î–æ—Å—Ç–∞–≤–∫–∞</option>
          </select>

<div id="deliveryFields" style="display:none; margin-top:10px;">
  <p class="deliveryNote">NB! –î–æ—Å—Ç–∞–≤–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ Tiskre K√ºla</p>  
  <button type="button" class="btn-ghost" id="chooseDateBtn">–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É *</button>
  <div id="deliveryCalendar" class="custom-calendar" style="display:none;"></div>

<select id="deliveryTime"></select>

<input type="text" id="deliveryAddress" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *" class="checkout-form">

<div class="form-group comment-group">
  <textarea id="orderComment" name="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" rows="3"></textarea>
</div>





</div>






          <div class="checkout-actions">
            <button id="placeOrder" class="btn-primary" type="button">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
            <button id="clearCartBtn" class="btn-ghost" type="button">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div id="cartBackdrop" class="cart-backdrop"></div>





<script>
const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRU16G77uq0XR1rGplEVVqn5-049-uhe-ycWu0DdNktVUOXvgfCMuV2pJwU-XPR8xLLCNdwOgh4q1Zs/pub?gid=0&single=true&output=csv';

function updateCartUI() {
  renderCart();
  updateDeliveryTimes();
}

// ===== –ü–ª–∞–≤–∞—é—â–∏–π —Ñ–∏–ª—å—Ç—Ä =====
const mainBar = document.getElementById('menuFilters');
const floatingBar = document.getElementById('menuFiltersFloating');

function shouldShowFloatingBar() {
  if (window.innerWidth > 767) return true;
  const firstSection = document.querySelector('.menu-section .grid');
  if (!firstSection) return false;
  const cards = Array.from(firstSection.children);
  if (cards.length < 2) return false;
  const rect1 = cards[0].getBoundingClientRect();
  const rect2 = cards[1].getBoundingClientRect();
  return rect1.top === rect2.top;
}

window.addEventListener('scroll', () => {
  const mainTop = mainBar.getBoundingClientRect().top;
  if (!shouldShowFloatingBar() || mainTop > 0) floatingBar.classList.remove('show');
  else floatingBar.classList.add('show');

  updateActiveFilter();
});

window.addEventListener('resize', () => {
  if (!shouldShowFloatingBar()) floatingBar.classList.remove('show');
});

// ===== –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é –∏–∑ Google Sheets =====
async function updateMenuFromSheet() {
  try {
    const res = await fetch(sheetUrl);
    const text = await res.text();
    const rows = text.trim().split('\n').map(r => r.split(','));
    const headers = rows[0].map(h => h.trim());
    const data = rows.slice(1).map(r => Object.fromEntries(r.map((v, i) => [headers[i], v.trim()])));

    let ordersEnabled = true;

    for (let item of data) {
      if(item['id'] && item['id'].toLowerCase() === 'orders_enabled') {
        ordersEnabled = (item['–î–æ—Å—Ç—É–ø–Ω–æ'] || item['–¶–µ–Ω–∞'] || item['–¶–µ–Ω–∞_—Å–æ_—Å–∫–∏–¥–∫–æ–π'] || item['–°–∫–∏–¥–∫–∞'] || item['–°–∫—Ä—ã—Ç–æ'] || 'yes').toLowerCase() === 'yes';
        document.getElementById('orders-disabled-note').style.display = ordersEnabled ? 'none' : 'block';
        if (placeOrderBtn) {
        placeOrderBtn.style.display = ordersEnabled ? 'inline-block' : 'none';
    }

    continue;
}


// –ù–ê–°–¢–†–û–ô–ö–ò –î–û–°–¢–ê–í–ö–ò –ò–ó –¢–ê–ë–õ–ò–¶–´
if (item['id'] && item['id'].toLowerCase() === 'delivery_cost') {
    DELIVERY_COST = parseFloat(item['–¶–µ–Ω–∞']?.replace(',', '.')) || 0;
    continue;
}

if (item['id'] && item['id'].toLowerCase() === 'free_delivery_limit') {
    FREE_DELIVERY_LIMIT = parseFloat(item['–¶–µ–Ω–∞']?.replace(',', '.')) || 0;
    continue;
}



      const el = document.querySelector(`.card[data-id="${item['id']}"]`);
      if (!el) continue;

      const priceEl = el.querySelector('.price');
      const overlay = el.querySelector('.overlay-unavailable');
      const cartIcon = el.querySelector('.cart-icon');

      const available = (item['–î–æ—Å—Ç—É–ø–Ω–æ'] || '').toLowerCase() === 'true';
      const hidden = (item['–°–∫—Ä—ã—Ç–æ'] || '').toLowerCase() === 'true';
      el.style.display = hidden ? 'none' : '';

      // –¶–µ–Ω–∞ –∏ —Å–∫–∏–¥–∫–∞
      const basePrice = parseFloat(item['–¶–µ–Ω–∞'].replace(',', '.')) || 0;
      const discountPrice = parseFloat(item['–¶–µ–Ω–∞_—Å–æ_—Å–∫–∏–¥–∫–æ–π']?.replace(',', '.')) || 0;
      const discountPercent = item['–°–∫–∏–¥–∫–∞'] ? parseInt(item['–°–∫–∏–¥–∫–∞']) : 0;
      let priceHTML = '';

      if (discountPrice > 0 && discountPrice < basePrice) {
        const formattedOld = basePrice.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const formattedNew = discountPrice.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        priceHTML = `<span class="discount">-${discountPercent}%</span> <span class="old-price">${formattedOld} ‚Ç¨</span> <span class="new-price">${formattedNew} ‚Ç¨</span>`;
        el.classList.add('has-discount');
        if (!el.querySelector('.discount-badge')) {
          const badge = document.createElement('div');
          badge.className = 'discount-badge';
          badge.textContent = '–°–∫–∏–¥–∫–∞';
          el.querySelector('.photo').appendChild(badge);
        }
      } else {
        const formattedBase = basePrice.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        priceHTML = `${formattedBase} ‚Ç¨`;
        el.classList.remove('has-discount');
      }
      if(priceEl) priceEl.innerHTML = priceHTML;

      // –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
      if (!available) {
        el.classList.add('unavailable');
        if(overlay) overlay.textContent = '–í—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
        if(cartIcon) cartIcon.classList.add('hidden');
      } else {
        el.classList.remove('unavailable');
        if(overlay) overlay.textContent = '';
        if(cartIcon) ordersEnabled ? cartIcon.classList.remove('hidden') : cartIcon.classList.add('hidden');
      }
    }

    // –ö–æ—Ä–∑–∏–Ω–∞
document.querySelectorAll('.cart-icon').forEach(icon => {
  icon.addEventListener('click', () => {
    const card = icon.closest('.card');
    addToCart(card);
  });
});

    document.querySelector('.floating-cart').onclick = () => {
  if(!ordersEnabled) showToast('–ó–∞–∫–∞–∑—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è', true);
  // –∏–Ω–∞—á–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, —á—Ç–æ–±—ã –Ω–∞–¥–ø–∏—Å—å –Ω–µ –ø–æ—è–≤–ª—è–ª–∞—Å—å
};


    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    updateSpecialOffersSection();

updateCartUI();



  } catch (e) { console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é', e); }
}

// ===== –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è =====
function updateSpecialOffersSection() {
  const specialGrid = document.querySelector('#specialOffers .grid');
  const specialSection = document.getElementById('specialOffers');
  const buttons = document.querySelectorAll('#menuFilters button, #menuFiltersFloating button');

  if (!specialGrid || !specialSection) return;
  specialGrid.innerHTML = '';
  const discountedCards = document.querySelectorAll('.card.has-discount');

  if (discountedCards.length > 0) {
    discountedCards.forEach(card => {
      const clone = card.cloneNode(true);
      specialGrid.appendChild(clone);
    });

    specialSection.style.display = 'block';
    specialSection.classList.add('special-offers-section');

    buttons.forEach(btn => { 
      if(btn.textContent.trim().toLowerCase() === '–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è') btn.style.display='inline-block'; 
    });

    // –ù–∞–≤–µ—à–∏–≤–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –Ω–∞ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
specialGrid.querySelectorAll('.cart-icon').forEach(icon => {
  icon.onclick = () => {
    const card = icon.closest('.card');
    addToCart(card); // —Ç–µ–ø–µ—Ä—å —Ç–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É —Å —É—á—ë—Ç–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
  }
});


  } else {
    specialSection.style.display = 'none';
    buttons.forEach(btn => { 
      if(btn.textContent.trim().toLowerCase() === '–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è') btn.style.display='none'; 
    });
  }
}

// ===== –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ =====
function animateCards() {
  const sections = document.querySelectorAll('.menu-section');
  sections.forEach((section, secIndex) => {
    const cards = section.querySelectorAll('.card');
    cards.forEach((card, i) => {
      card.style.opacity = 0;
      card.style.transform = 'translateY(20px) scale(0.95)';
      setTimeout(() => {
        card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
        card.style.opacity = 1;
        card.style.transform = 'translateY(0) scale(1)';
      }, i * 60 + secIndex * 120);
    });
    const title = section.querySelector('.section-title');
    if (title) {
      title.style.opacity = 0;
      title.style.transform = 'translateY(20px)';
      setTimeout(() => {
        title.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        title.style.opacity = 1;
        title.style.transform = 'translateY(0)';
      }, cards.length * 60 + secIndex * 130);
    }
    setTimeout(() => section.classList.add('show'), cards.length * 60 + secIndex * 150);
  });
  mainBar.classList.add('show');
}

// ===== –ê–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä =====
const sections = document.querySelectorAll('.menu-section');
const buttons = document.querySelectorAll('#menuFilters button, #menuFiltersFloating button');

function updateActiveFilter() {
  const scrollTop = window.scrollY + 120; // –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É
  let currentSection = null;

    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–∞–º–æ–º –≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π —Ä–∞–∑–¥–µ–ª
  if (window.scrollY < 50) {
    const firstSection = sections[0];
    if (firstSection) {
      const firstName = firstSection.querySelector('.section-title')?.textContent.trim().toLowerCase();
      buttons.forEach(btn => {
        if (btn.textContent.trim().toLowerCase() === firstName) btn.classList.add('active-filter');
        else btn.classList.remove('active-filter');
      });
    }
    return; // —á—Ç–æ–±—ã –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å –æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å
  }


  const specialSection = document.querySelector('.special-offers-section');
  if (specialSection) {
    const sectionTop = specialSection.offsetTop;
    const sectionBottom = sectionTop + specialSection.offsetHeight;
    if (scrollTop >= sectionTop && scrollTop < sectionTop + specialSection.offsetHeight / 2) {
      currentSection = specialSection;
    }
  }

  if (!currentSection) {
    sections.forEach(sec => {
      if (sec.classList.contains('special-offers-section')) return;
      const top = sec.offsetTop;
      const bottom = top + sec.offsetHeight;
      if (scrollTop >= top && scrollTop < bottom) {
        currentSection = sec;
      }
    });
  }

  if (!currentSection) return;
  const sectionName = currentSection.querySelector('.section-title')?.textContent.trim().toLowerCase();
  buttons.forEach(btn => {
    if (btn.textContent.trim().toLowerCase() === sectionName) btn.classList.add('active-filter');
    else btn.classList.remove('active-filter');
  });
}

// ===== –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –ø–æ –∫–Ω–æ–ø–∫–µ =====
buttons.forEach(btn => {
  btn.addEventListener('click', e => {
    const text = e.target.textContent.trim().toLowerCase();
    const targetSection = Array.from(sections).find(sec => {
      const title = sec.querySelector('.section-title');
      return title && title.textContent.trim().toLowerCase() === text;
    });
    if (targetSection) {
      window.scrollTo({
        top: targetSection.offsetTop - 80,
        behavior: 'smooth'
      });
    }
  });
});

document.addEventListener('click', (e) => {
  const btn = e.target.closest('button[data-action="contacts"]');
  if (!btn) return;

  const footer = document.getElementById('contacts');
  if (!footer) return;

  footer.scrollIntoView({
    behavior: 'smooth',
    block: 'start'
  });
});


// ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è =====
(async () => {
  await updateMenuFromSheet();   // –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫—É –º–µ–Ω—é
  updateActiveFilter();          // –æ–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä
  setTimeout(() => {
    animateCards();              // –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
  }, 250);
  
})();


// ===== –í—ã–±–æ—Ä —à–∞–ø–æ—á–∫–∏ =====
const rollSelectWrappers = document.querySelectorAll('.roll-select-wrapper');

rollSelectWrappers.forEach(wrapper => {
  const btn = wrapper.querySelector('.select-btn');
  const dropdown = wrapper.querySelector('.select-dropdown');
  const arrow = wrapper.querySelector('.arrow');

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ "–°—ã—Ä–Ω–∞—è —à–∞–ø–æ—á–∫–∞" –≤ —Å–ø–∏—Å–∫–µ
  let defaultTopping = '–°—ã—Ä–Ω–∞—è —à–∞–ø–æ—á–∫–∞';
  let exists = Array.from(dropdown.querySelectorAll('li')).some(li => li.textContent.trim() === defaultTopping);
  if (!exists) {
    const li = document.createElement('li');
    li.textContent = defaultTopping;
    dropdown.prepend(li);
  }

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  btn.firstChild.textContent = defaultTopping + ' ';

  // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ —Å–ø–∏—Å–∫–∞
  btn.addEventListener('click', (e) => {
    e.preventDefault();
    dropdown.classList.toggle('show');
    arrow.style.transform = dropdown.classList.contains('show') ? 'rotate(180deg)' : 'rotate(0deg)';
  });

  // –í—ã–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
  dropdown.querySelectorAll('li').forEach(item => {
    item.addEventListener('click', () => {
      btn.firstChild.textContent = item.textContent + ' ';
      dropdown.classList.remove('show');
      arrow.style.transform = 'rotate(0deg)';
    });
  });

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
  document.addEventListener('click', (e) => {
    if (!wrapper.contains(e.target)) {
      dropdown.classList.remove('show');
      arrow.style.transform = 'rotate(0deg)';
    }
  });
});








// ===== –ù–ê–°–¢–†–û–ô–ö–ò =====
const cartItemsContainer = document.querySelector('.cart-items');
const subtotalEl = document.querySelector('.subtotal-price');
const deliveryEl = document.querySelector('.delivery-price');
const discountEl = document.querySelector('.discount-price');
const totalEl = document.querySelector('.total-price');
const cartCountEl = document.querySelector('.cart-count');
const cartFullscreenEl = document.getElementById('cartFullscreen');
const cartBackdrop = document.getElementById('cartBackdrop');
const closeBtn = document.getElementById('closeCart');
const placeOrderBtn = document.getElementById('placeOrder');
const clearCartBtn = document.getElementById('clearCartBtn');
const checkoutForm = document.getElementById('checkoutForm');
const phoneInput = checkoutForm?.querySelector('input[name="phone"]');


const paymentSelect = checkoutForm?.payment;

paymentSelect?.addEventListener('change', () => {
    if (paymentSelect.value.toLowerCase() === '–∫–∞—Ä—Ç–∞ –æ–Ω–ª–∞–π–Ω') {
        placeOrderBtn.textContent = '–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ';
    } else {
        placeOrderBtn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑';
    }
});




if(phoneInput){
    phoneInput.addEventListener('input', () => {
        phoneInput.value = phoneInput.value.replace(/[^+\d]/g,'');
    });
}

let DELIVERY_COST = 5.00;
let FREE_DELIVERY_LIMIT = 50.00;
const ITEM_LIMIT = 20;
const cart = new Map();


// ===== LOCALSTORAGE =====
function saveCart(){ localStorage.setItem('cart', JSON.stringify(Object.fromEntries(cart))); }
function loadCart(){
    const data = localStorage.getItem('cart');
    if(data){
        const obj = JSON.parse(data);
        cart.clear();
        for(const [id,item] of Object.entries(obj)){
            cart.set(id,item);
        }
    }
}

// ===== TOAST =====
function showToast(msg, isRed = false, duration = 2500) {
    const toast = document.getElementById('toast');
    if (!toast) return;

    toast.innerHTML = msg;
    toast.className = 'toast show ' + (isRed ? 'red' : 'white');

    // –æ—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä, –µ—Å–ª–∏ –±—ã–ª
    if (toast._timer) {
        clearTimeout(toast._timer);
    }

    toast._timer = setTimeout(() => {
        toast.classList.remove('show');
    }, duration);
}


// ===== ESCAPE HTML =====
function escapeHtml(str){ return String(str).replace(/[&<>"]/g, s=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s])); }

// ===== –î–û–ë–ê–í–õ–ï–ù–ò–ï –í –ö–û–†–ó–ò–ù–£ =====
function addToCart(card){
    const ordersEnabled = document.getElementById('orders-disabled-note')?.style.display==='none';
    if(!ordersEnabled) return showToast('–ó–∞–∫–∞–∑—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è', true);

    const id = card.dataset.id || card.querySelector('.title')?.textContent.trim();
    const name = card.querySelector('.title .name')?.textContent.trim() || '–¢–æ–≤–∞—Ä';
    const priceEl = card.querySelector('.price');
    const newPriceEl = priceEl?.querySelector('.new-price');
    const oldPriceEl = priceEl?.querySelector('.old-price');

    const unitPrice = newPriceEl
        ? parseFloat(newPriceEl.textContent.replace(/[^\d.,]/g,'').replace(',','.'))||0
        : parseFloat(priceEl?.textContent.replace(/[^\d.,]/g,'').replace(',','.'))||0;
    const originalPrice = oldPriceEl
        ? parseFloat(oldPriceEl.textContent.replace(/[^\d.,]/g,'').replace(',','.'))||unitPrice
        : unitPrice;

    if(cart.has(id)){
        const item = cart.get(id);
        if(item.qty<ITEM_LIMIT){
            item.qty++;
            cart.set(id,item);
            showToast('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É');
        } else showToast(`–ú–∞–∫—Å–∏–º—É–º ${ITEM_LIMIT} —à—Ç—É–∫`, true);
    } else {
        cart.set(id,{name,unitPrice,originalPrice,qty:1});
        showToast('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É');
    }

    saveCart();
    updateCartUI();
}

// ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–ò –°–ú–ï–ù–ï –°–ü–û–°–û–ë–ê –ü–û–õ–£–ß–ï–ù–ò–Ø =====
checkoutForm?.method?.addEventListener('change', renderCart);


// ===== OPEN/CLOSE =====
function openCart(){ cartFullscreenEl?.setAttribute('aria-hidden','false'); cartBackdrop?.classList.add('show'); }
function closeCart(){ cartFullscreenEl?.setAttribute('aria-hidden','true'); cartBackdrop?.classList.remove('show'); }
document.querySelector('.floating-cart')?.addEventListener('click',openCart);
closeBtn?.addEventListener('click',closeCart);
cartBackdrop?.addEventListener('click',closeCart);

// ===== –û–ß–ò–°–¢–ö–ê =====
clearCartBtn?.addEventListener('click',()=>{
    cart.clear();
    saveCart();
    showToast('–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞');
    updateCartUI();
});

// ====== –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã ======
if (checkoutForm) {
  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  const savedForm = localStorage.getItem('checkoutFormData');
  if (savedForm) {
    const data = JSON.parse(savedForm);
    for (const key in data) {
      if (checkoutForm[key]) checkoutForm[key].value = data[key];
    }
  }

const addressInput = document.getElementById('deliveryAddress');

// –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞
if (addressInput) {
    const savedAddress = localStorage.getItem('deliveryAddress');
    if (savedAddress) {
        addressInput.value = savedAddress;
    }

    // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
    addressInput.addEventListener('input', () => {
        localStorage.setItem('deliveryAddress', addressInput.value.trim());
    });
}


  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –ø–æ–ª—è
  checkoutForm.addEventListener('input', () => {
    const data = {};
    Array.from(checkoutForm.elements).forEach(el => {
      if (el.name) data[el.name] = el.value;
    });
    localStorage.setItem('checkoutFormData', JSON.stringify(data));
  });
}

// ====== –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ ======
placeOrderBtn?.addEventListener('click', async () => {
    if (!checkoutForm) return;
    

    const name = checkoutForm.name.value.trim();
    const phone = checkoutForm.phone.value.trim();
    const email = checkoutForm.email.value.trim();
    const payment = checkoutForm.payment.value;
    const method = checkoutForm.method.value.toLowerCase();
    const comment = checkoutForm.comment?.value.trim() || '';

    
    // ===== –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã =====
    
 // ===== –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª–µ–π —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π =====
let hasError = false;

const fields = [
  {el: checkoutForm.name, required: true},
  {el: checkoutForm.phone, required: true},
  {el: checkoutForm.email, required: true},
  {el: checkoutForm.payment, required: true},
  {el: checkoutForm.method, required: true},
  {el: document.getElementById('deliveryTime'), required: true},
  {el: document.getElementById('chooseDateBtn'), required: true, isBtn: true},
  {el: document.getElementById('deliveryAddress'), required: method === '–¥–æ—Å—Ç–∞–≤–∫–∞'}
];

fields.forEach(f => {
  const value = f.isBtn ? f.el.textContent : f.el.value;
  if (f.required && (!value || (f.isBtn && !value.includes('–î–∞—Ç–∞')))) {
    f.el.classList.add('error');
    hasError = true;
  } else {
    f.el.classList.remove('error');
  }
});

if (cart.size === 0) {
        showToast('–í –∫–æ—Ä–∑–∏–Ω–µ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤', true);
        return;
    }

if (hasError) {
  showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', true);
  return;
}


    const isDelivery = method === '–¥–æ—Å—Ç–∞–≤–∫–∞';
    const isPickup = method === '—Å–∞–º–æ–≤—ã–≤–æ–∑';

    const dateBtn = document.getElementById('chooseDateBtn');
    const timeSelect = document.getElementById('deliveryTime');
    const addressInput = document.getElementById('deliveryAddress');

    // ===== –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç—ã =====
    if ((isDelivery || isPickup) && (!dateBtn || !dateBtn.textContent.includes('–î–∞—Ç–∞'))) {
        showToast(isDelivery ? '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è' : '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', true);
        return;
    }

    // ===== –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ =====
    if ((isDelivery || isPickup) && (!timeSelect || !timeSelect.value)) {
        showToast(isDelivery ? '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è' : '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', true);
        return;
    }

    // ===== –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–∞ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ =====
    if (isDelivery && (!addressInput || !addressInput.value.trim())) {
        showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', true);
        return;
    }

    // ===== –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É–º–º—ã =====
    const total = parseFloat(totalEl.textContent);
    if (total <= 0) {
        showToast('–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0 ‚Ç¨', true);
        return;
    }



// ===== –õ–æ–≥–∏–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã –∫–∞—Ä—Ç–æ–π =====
if (payment.toLowerCase() === '–∫–∞—Ä—Ç–∞ –æ–Ω–ª–∞–π–Ω') {
    showToast('<strong>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ–ø–ª–∞—Ç—ã...</strong><br><small>–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 1 –º–∏–Ω—É—Ç—ã</small>', false, 120000);

const cartData = [];
cart.forEach((item, id) => {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã, –≤–∫–ª—é—á–∞—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ
    cartData.push({
        id,
        name: item.name,
        unitPrice: item.unitPrice > 0 ? item.unitPrice : 0.01, // 1 —Ü–µ–Ω—Ç –≤–º–µ—Å—Ç–æ 0
        qty: item.qty,
        promoFree: item.promoFree || false
    });
});


    const delivery = parseFloat(deliveryEl.textContent) || 0;

    // ===== –ü—Ä–æ–º–æ–∫–æ–¥ =====
// ===== –ü—Ä–æ–º–æ–∫–æ–¥ (–¢–û–õ–¨–ö–û –±–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ) =====
let promoForStripe = null;

if (activePromo) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º—ã –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ min_total_discount
  const subtotalValue = parseFloat(subtotalEl.textContent.replace(/[^\d.]/g, "")) || 0;
  
  if (activePromo.type === 'min_total_discount' && subtotalValue < activePromo.min) {
    promoForStripe = null; // –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ ‚Äî –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–º–æ–∫–æ–¥
  } else if (activePromo.type === 'cart_discount') {
    promoForStripe = {
      type: 'cart_discount',
      value: activePromo.value
    };
  } else if (activePromo.type === 'flat_discount' || activePromo.type === 'min_total_discount') {
    promoForStripe = {
      type: activePromo.type,
      value: activePromo.value
    };
  }
}

const orderData = {
    checkout: {
        name: checkoutForm.name.value,
        phone: checkoutForm.phone.value,
        email: checkoutForm.email.value,
        payment: checkoutForm.payment.value,
        method: checkoutForm.method.value,
        date: chooseDateBtn?.textContent || '',
        time: deliveryTime?.value || '',
        address: deliveryAddress?.value || '',
        comment: checkoutForm.comment?.value || '',
        promo: activePromo?.code || ''
    },
    total: parseFloat(totalEl.textContent) || 0,
    delivery: parseFloat(deliveryEl.textContent) || 0,
    discount: parseFloat(discountEl.textContent) || 0,
    lang: currentLang
};


// –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
fetch("https://stripe-test-it0r.onrender.com/create-checkout-session", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    cart: cartData,
    delivery,
    promo: promoForStripe,   // ‚Üê –¢–û–õ–¨–ö–û –≠–¢–û
    lang: currentLang,  // ‚Üê –ø–µ—Ä–µ–¥–∞–µ–º —è–∑—ã–∫
    orderData
  })
})
.then(res => res.json())
.then(data => {
  if (data.url) {
    window.location.href = data.url;
  } else {
    alert(data.error || "–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞");
  }
})
.catch(err => alert("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É: " + err.message));

    return;
}



function updateOrderButtonText() {
    if (!checkoutForm || !placeOrderBtn) return;

    const payment = checkoutForm.payment.value;

    if (payment === '–ö–∞—Ä—Ç–∞ –æ–Ω–ª–∞–π–Ω') {
        placeOrderBtn.textContent = '–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ';
    } else {
        placeOrderBtn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑';
    }
}

const orderData = {
        cart: Array.from(cart.entries()).map(([id, item]) => ({
            id,
            name: item.name,
            unitPrice: item.unitPrice,
            qty: item.qty,
            promoFree: item.promoFree || false
        })),
        checkout: {
            name: checkoutForm.name.value,
            phone: checkoutForm.phone.value,
            email: checkoutForm.email.value,
            payment: checkoutForm.payment.value,
            method: checkoutForm.method.value,
            date: chooseDateBtn?.textContent || '',
            time: deliveryTime?.value || '',
            address: deliveryAddress?.value || '',
            comment: checkoutForm.comment?.value || '',
            promo: activePromo?.code || ''
        },
        total: parseFloat(totalEl.textContent) || 0,
        delivery: parseFloat(deliveryEl.textContent) || 0,
        discount: parseFloat(discountEl.textContent) || 0,
        lang: currentLang
    };


        const res = await fetch('https://telegram-server-fcgc.onrender.com/order', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(orderData)
        });
        const result = await res.json();

            showToast('–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç ‚Äî —Å–ø–∞—Å–∏–±–æ!');
    cart.clear();
resetPromo(); // üî• –í–û–¢ –≠–¢–ê –°–¢–†–û–ö–ê
resetCheckoutExtras();
    checkoutForm.reset();
    if (dateBtn) dateBtn.textContent = isDelivery ? '–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É –¥–æ—Å—Ç–∞–≤–∫–∏' : '–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É —Å–∞–º–æ–≤—ã–≤–æ–∑–∞';
    if (timeSelect) timeSelect.value = '';
    if (addressInput) addressInput.value = '';

    setTimeout(closeCart, 900);

    saveCart();
    updateCartUI();
});





// ========================================================
// 1. –ó–ê–ì–†–£–ó–ö–ê –ü–†–û–ú–û–ö–û–î–û–í –ò–ó GOOGLE SHEETS
// ========================================================
const promoSheetUrl =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRU16G77uq0XR1rGplEVVqn5-049-uhe-ycWu0DdNktVUOXvgfCMuV2pJwU-XPR8xLLCNdwOgh4q1Zs/pub?gid=1716078291&single=true&output=csv";

let promoCodes = {}; 
let activePromo = null;

// ===== –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–∞ =====
function savePromo() {
  if (activePromo) localStorage.setItem('activePromo', JSON.stringify(activePromo));
  else localStorage.removeItem('activePromo');
}

function loadPromo() {
  const data = localStorage.getItem('activePromo');
  const appliedAt = localStorage.getItem('promoAppliedAt');

  if (data && appliedAt) {
    const now = Date.now();
    const elapsed = now - Number(appliedAt);

    if (elapsed < 1800000) { // 15 –º–∏–Ω—É—Ç
      activePromo = JSON.parse(data);
      promoInput.value = activePromo.code || '';
      if (activePromo.type === 'free_item' && activePromo.min > 0) {
        promoMessage.textContent = `–ü—Ä–æ–º–æ–∫–æ–¥ "${activePromo.code}" –∞–∫—Ç–∏–≤–µ–Ω –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –æ—Ç ${activePromo.min} ‚Ç¨`;
      } else {
        promoMessage.textContent = `–ü—Ä–æ–º–æ–∫–æ–¥ "${activePromo.code}" –ø—Ä–∏–º–µ–Ω—ë–Ω`;
      }
      promoMessage.style.color = 'green';
    } else {
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–º–æ–∫–æ–¥, –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ > 15 –º–∏–Ω
      activePromo = null;
      promoInput.value = '';
      promoMessage.textContent = '';
      localStorage.removeItem('activePromo');
      localStorage.removeItem('promoAppliedAt');
    }
  }
}



async function loadPromoCodes() {
  try {
    const res = await fetch(promoSheetUrl);
    const csv = await res.text();
    const lines = csv.split("\n").map(l => l.trim());

    promoCodes = {};

    for (let i = 1; i < lines.length; i++) {
      if (!lines[i]) continue;

      const cols = lines[i].split(",");

      const code = cols[0]?.trim().toUpperCase();
      const type = cols[1]?.trim();
      const value = Number(cols[2]) || 0;
      const min = Number(cols[3]) || 0;
      const itemId = cols[4]?.trim();
      const enabled = cols[5]?.trim().toUpperCase() === "YES";

      if (!enabled || !code) continue;

      promoCodes[code] = { type };
      if (value) promoCodes[code].value = value;
      if (min) promoCodes[code].min = min;
      if (itemId) promoCodes[code].itemId = itemId;
    }

    console.log("–ü—Ä–æ–º–æ–∫–æ–¥—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:", promoCodes);
  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤:", err);
  }
}

loadPromoCodes();


// ========================================================
// 2. –≠–õ–ï–ú–ï–ù–¢–´ –ò UI
// ========================================================
const showPromoBtn = document.getElementById('showPromoBtn');
const promoBox = document.querySelector('.promo-code-box');
const promoInput = document.getElementById('promoInput');
const applyPromoBtn = document.getElementById('applyPromo');
const cancelPromoBtn = document.querySelector('.promo-actions #cancelPromo');
const promoMessage = document.getElementById('promoMessage');

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
showPromoBtn.addEventListener('click', () => {
  promoBox.style.display = 'block';
  showPromoBtn.style.display = 'none';
});

// –ó–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
promoInput.addEventListener('input', () => {
  promoInput.value = promoInput.value.toUpperCase();
});

// –û—Ç–º–µ–Ω–∞ –∫–Ω–æ–ø–∫–æ–π "–û—Ç–º–µ–Ω–∞" (UI)
document.getElementById("cancelPromo").addEventListener("click", () => {
  promoBox.style.display = "none";
  showPromoBtn.style.display = "block";
});


// ========================================================
// 3. –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ü–†–û–ú–û–ö–û–î–ê
// ========================================================
applyPromoBtn.addEventListener('click', () => {
  const code = promoInput.value.trim().toUpperCase();
  if (!code) return;

// ===== –£–î–ê–õ–Ø–ï–ú –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞ =====
if (activePromo && activePromo.type === 'free_item') {
    const oldId = activePromo.itemId + '_promo';
    if (cart.has(oldId)) {
        cart.delete(oldId);
        saveCart();
        updateDeliveryTimes();
    }
}


  if (promoCodes[code]) {
    activePromo = promoCodes[code];
    activePromo.code = code;
    savePromo();

    localStorage.setItem('promoAppliedAt', Date.now());


    if (activePromo.type === 'free_item', 'min_total_discount' && activePromo.min > 0) {
      promoMessage.textContent = `–ü—Ä–æ–º–æ–∫–æ–¥ "${code}" –∞–∫—Ç–∏–≤–µ–Ω –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –æ—Ç ${activePromo.min} ‚Ç¨`;
    } else {      
      promoMessage.textContent = `–ü—Ä–æ–º–æ–∫–æ–¥ "${code}" –ø—Ä–∏–º–µ–Ω—ë–Ω`;
    }
    promoMessage.style.color = 'green';
  } else {
    promoMessage.textContent = '–ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω';
    promoMessage.style.color = 'red';
    activePromo = null;
  }

  updateCartUI();
});



// ========================================================
// 4. –û–¢–ú–ï–ù–ê –ü–†–û–ú–û–ö–û–î–ê (–õ–û–ì–ò–ö–ê)
// ========================================================
cancelPromoBtn.addEventListener('click', () => {
  // –£–¥–∞–ª—è–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä –µ—Å–ª–∏ –±—ã–ª
  if (activePromo && activePromo.type === 'free_item') {
    const id = activePromo.itemId + '_promo';
    if (cart.has(id)) cart.delete(id);
  }

  activePromo = null;
  promoInput.value = '';
  promoMessage.textContent = '';

  updateCartUI();
});

function resetPromo() {
    // —É–¥–∞–ª–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å
    if (activePromo && activePromo.type === 'free_item') {
        const promoId = activePromo.itemId + '_promo';
        if (cart.has(promoId)) {
            cart.delete(promoId);
        }
    }

    activePromo = null;

    localStorage.removeItem('activePromo');

    if (promoInput) promoInput.value = '';
    if (promoMessage) promoMessage.textContent = '';
    
    // —Å–≤–µ—Ä–Ω—É—Ç—å UI –ø—Ä–æ–º–æ–∫–æ–¥–∞
    if (promoBox && showPromoBtn) {
        promoBox.style.display = 'none';
        showPromoBtn.style.display = 'block';
    }
}

function resetCheckoutExtras() {
    // ===== –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π =====
    const commentField = checkoutForm?.querySelector('[name="comment"]');
    if (commentField) commentField.value = '';

    // ===== —Å–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è =====
    const methodField = checkoutForm?.querySelector('[name="method"]');
    if (methodField) methodField.value = '';

    // ===== —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã =====
    const paymentField = checkoutForm?.querySelector('[name="payment"]');
    if (paymentField) paymentField.value = '';

    // ===== —á–∏—Å—Ç–∏–º localStorage =====
    localStorage.removeItem('checkoutComment');

    const savedForm = localStorage.getItem('checkoutFormData');
    if (savedForm) {
        const data = JSON.parse(savedForm);
        delete data.comment;
        delete data.method;
        delete data.payment;
        localStorage.setItem('checkoutFormData', JSON.stringify(data));
    }
}


// ========================================================
// 5. –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ü–†–ò –†–ï–ù–î–ï–†–ï –ö–û–†–ó–ò–ù–´
// ========================================================
function renderCart() {
  if (!cartItemsContainer) return;
  cartItemsContainer.innerHTML = '';

// ===== –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Ç–µ–∫—É—â–∏–º –∫–∞—Ä—Ç–æ—á–∫–∞–º =====
cart.forEach((item, id) => {
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ –ø—Ä–æ–º–æ–∫–æ–¥—É
    if (item.unitPrice === 0 && item.promoFree) return;

    const cardEl = document.querySelector(`.card[data-id="${id}"]`);
    if (!cardEl) return;

    const priceEl = cardEl.querySelector('.price');
    const newPriceEl = priceEl?.querySelector('.new-price');
    const oldPriceEl = priceEl?.querySelector('.old-price');

    const currentUnitPrice = newPriceEl
        ? parseFloat(newPriceEl.textContent.replace(/[^\d.,]/g,'').replace(',','.')) || 0
        : parseFloat(priceEl?.textContent.replace(/[^\d.,]/g,'').replace(',','.')) || 0;

    const currentOriginalPrice = oldPriceEl
        ? parseFloat(oldPriceEl.textContent.replace(/[^\d.,]/g,'').replace(',','.')) || currentUnitPrice
        : currentUnitPrice;

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ü–µ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å
    if(item.unitPrice !== currentUnitPrice || item.originalPrice !== currentOriginalPrice) {
        item.unitPrice = currentUnitPrice;
        item.originalPrice = currentOriginalPrice;
        cart.set(id, item);
    }
});


const freeInfo = document.getElementById('free-delivery-info');
if (FREE_DELIVERY_LIMIT > 0) {
    freeInfo.style.display = 'block';
    freeInfo.textContent = `–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –Ω–∞ —Å—É–º–º—É ${FREE_DELIVERY_LIMIT} ‚Ç¨`;
} else {
    freeInfo.style.display = 'none';
}



  let subtotal = 0;
  cart.forEach((item, id) => subtotal += item.unitPrice * item.qty);


  // ======= –û–ë–†–ê–ë–û–¢–ö–ê –ë–ï–°–ü–õ–ê–¢–ù–û–ì–û –¢–û–í–ê–†–ê =======
  if (activePromo && activePromo.type === 'free_item') {
    const promoId = activePromo.itemId + "_promo";
    const exists = cart.get(promoId);

    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—É–º–º–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç
    if (subtotal >= (activePromo.min || 0) && !exists) {
      const cardEl = document.querySelector(`.card[data-id="${activePromo.itemId}"]`);
      if (cardEl) {
        const name = cardEl.querySelector('.title .name')?.textContent.trim() || '–¢–æ–≤–∞—Ä';

        cart.set(promoId, {
          name,
          unitPrice: 0,
          originalPrice: 0,
          qty: 1,
          promoFree: true
        });
      }
    }

    // –£–¥–∞–ª—è–µ–º –µ—Å–ª–∏ —Å—É–º–º–∞ —Å—Ç–∞–ª–∞ –Ω–∏–∂–µ –º–∏–Ω–∏–º—É–º–∞
    if (subtotal < (activePromo.min || 0) && exists) {
      cart.delete(promoId);
    }
  }


  // ======= –†–ï–ù–î–ï–† –¢–û–í–ê–†–û–í =======
  cart.forEach((item, id) => {
    const lineTotal = item.unitPrice * item.qty;

    const el = document.createElement('div');
    el.className = 'cart-item';
    el.dataset.id = id;

    el.innerHTML = `
      <div class="name">${escapeHtml(item.name)}</div>
      <div class="unit">
        ${item.unitPrice.toFixed(2)} ‚Ç¨
        ${item.originalPrice && item.originalPrice > item.unitPrice ? `<span class="old-price">${item.originalPrice.toFixed(2)} ‚Ç¨</span>` : ''}
      </div>
      <div class="qty-wrap">
        <button class="qty-btn btn-decr">‚àí</button>
        <div class="qty-value">${item.qty}</div>
        <button class="qty-btn btn-incr">+</button>
      </div>
      <div class="line-total">${lineTotal.toFixed(2)} ‚Ç¨</div>
      <button class="remove-btn">√ó</button>
    `;

    const incr = el.querySelector('.btn-incr');
    const decr = el.querySelector('.btn-decr');
    const removeBtn = el.querySelector('.remove-btn');

    // + –∫–Ω–æ–ø–∫–∞
    incr.addEventListener('click', () => {

    if (item.unitPrice === 0) {
        showToast('–ë–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑', true);
        return;
    }

    if (item.qty >= ITEM_LIMIT) {
        showToast(`–ú–∞–∫—Å–∏–º—É–º ${ITEM_LIMIT} —à—Ç—É–∫`, true);
        return;
    }
      if (item.qty < ITEM_LIMIT) item.qty++;
      cart.set(id, item);
      updateCartUI();
    });

    // - –∫–Ω–æ–ø–∫–∞
    decr.addEventListener('click', () => {
      if (item.qty > 1) item.qty--;
      else cart.delete(id);
      updateCartUI();
    });

    // –£–¥–∞–ª–µ–Ω–∏–µ
    removeBtn.addEventListener('click', () => {
  if (item.promoFree) {
    return;
  }
  cart.delete(id);
            saveCart();
            updateCartUI();
        });

        cartItemsContainer.appendChild(el);
    });


  // ========================================================
  // 6. –°–ö–ò–î–ö–ò, –î–û–°–¢–ê–í–ö–ê, –ò–¢–û–ì–ò
  // ========================================================

const checkoutForm = document.getElementById('checkoutForm');
const methodSelect = checkoutForm?.method;
const deliveryFields = document.getElementById('deliveryFields');
const deliveryNote = document.querySelector('.deliveryNote');
const chooseDateBtn = document.getElementById('chooseDateBtn');
const deliveryCalendar = document.getElementById('deliveryCalendar');
const deliveryTime = document.getElementById('deliveryTime');
const deliveryAddress = document.getElementById('deliveryAddress');

// ===== –°–°–´–õ–ö–ò –ù–ê GOOGLE SHEETS =====
const deliveryTimesSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRU16G77uq0XR1rGplEVVqn5-049-uhe-ycWu0DdNktVUOXvgfCMuV2pJwU-XPR8xLLCNdwOgh4q1Zs/pub?gid=1115998539&single=true&output=csv";
const minHoursSheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRU16G77uq0XR1rGplEVVqn5-049-uhe-ycWu0DdNktVUOXvgfCMuV2pJwU-XPR8xLLCNdwOgh4q1Zs/pub?gid=669184474&single=true&output=csv";

// ===== –î–∞–Ω–Ω—ã–µ =====
let deliveryTimesByDate = {}; // –∫–ª—é—á: "–¥–¥.–º–º.–≥–≥–≥–≥|–º–µ—Ç–æ–¥"
let minHoursRanges = [];      // –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ { maxItems: —á–∏—Å–ª–æ –∏–ª–∏ null, hours: —á–∏—Å–ª–æ }

// ===== –ó–ê–ì–†–£–ó–ö–ê –ú–ò–ù. –ß–ê–°–û–í –ò–ó GOOGLE SHEETS =====
async function loadMinHours() {
    try {
        const res = await fetch(minHoursSheetUrl);
        const csv = await res.text();
        const lines = csv.split("\n").map(l => l.trim());

        minHoursRanges = [];
        for (let i = 1; i < lines.length; i++) {
            if (!lines[i]) continue;
            const [maxItemsStr, hoursStr] = lines[i].split(",");
            const maxItems = maxItemsStr ? Number(maxItemsStr.trim()) : null;
            const hours = Number(hoursStr.trim());
            if (!isNaN(hours)) minHoursRanges.push({ maxItems, hours });
        }
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∏–Ω. —á–∞—Å–æ–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã", err);
    }
}

// ===== –ó–ê–ì–†–£–ó–ö–ê –í–†–ï–ú–ï–ù–ò –î–û–°–¢–ê–í–ö–ò –ò–ó GOOGLE SHEETS =====
async function loadDeliveryTimes() {
    try {
        const res = await fetch(deliveryTimesSheetUrl);
        const csv = await res.text();
        const lines = csv.split("\n").map(l => l.trim());

        deliveryTimesByDate = {};

        for (let i = 1; i < lines.length; i++) {
            if (!lines[i]) continue;
            const [dateStr, method, time, active] = lines[i].split(",");
            if (!active || active.trim().toUpperCase() !== "YES") continue;
            if (!dateStr || !method || !time) continue;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
            if (dateStr.includes("-")) {
                const [startStr, endStr] = dateStr.split("-").map(s => s.trim());
                const [startDay, startMonth, startYear] = startStr.split(".").map(Number);
                const [endDay, endMonth, endYear] = endStr.split(".").map(Number);

                let current = new Date(startYear, startMonth - 1, startDay);
                const end = new Date(endYear, endMonth - 1, endDay);

                while (current <= end) {
                    const day = current.getDate().toString().padStart(2, "0");
                    const month = (current.getMonth() + 1).toString().padStart(2, "0");
                    const year = current.getFullYear();
                    const formatted = `${day}.${month}.${year}`;

                    const key = `${formatted}|${method.trim().toLowerCase()}`;
                    if (!deliveryTimesByDate[key]) deliveryTimesByDate[key] = [];
                    deliveryTimesByDate[key].push(time.trim());

                    current.setDate(current.getDate() + 1);
                }
            } else {
                const key = `${dateStr.trim()}|${method.trim().toLowerCase()}`;
                if (!deliveryTimesByDate[key]) deliveryTimesByDate[key] = [];
                deliveryTimesByDate[key].push(time.trim());
            }
        }

        updateDeliveryTimes(); // –ø–µ—Ä–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏", err);
    }
}

// ===== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –°–õ–û–¢–û–í –ü–û –ú–ò–ù. –ß–ê–°–ê–ú =====
function filterDeliveryTimes(times) {
    if (!selectedDate) return [];

    const now = new Date();

    // —Å—á–∏—Ç–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    let totalItems = 0;
    cart.forEach(i => totalItems += i.qty);

    // –∏—â–µ–º –Ω—É–∂–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
    let minHours = 0;
    for (const range of minHoursRanges) {
        if (range.maxItems === null || totalItems <= range.maxItems) {
            minHours = range.hours;
            break;
        }
    }

    const [day, month, year] = selectedDate.split(".").map(Number);

    return times.filter(t => {
        const [startTime] = t.split("‚Äì");
        const [hours, minutes] = startTime.split(":").map(Number);
        const slotDate = new Date(year, month - 1, day, hours, minutes);
        const diffHours = (slotDate - now) / (1000 * 60 * 60);
        return diffHours >= minHours;
    });
}

// ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –í–†–ï–ú–ï–ù–ò –í SELECT =====
function updateDeliveryTimes() {
    if (!deliveryTime) return;

    const method = methodSelect?.value?.toLowerCase();
    if (!method) return;

    deliveryTime.innerHTML = "";

    // placeholder
    const placeholderOption = document.createElement('option');
    placeholderOption.value = "";
    placeholderOption.textContent = "–í—ã–±—Ä–∞—Ç—å –≤—Ä–µ–º—è *";
    placeholderOption.disabled = true;
    placeholderOption.selected = true;
    deliveryTime.appendChild(placeholderOption);

    if (!selectedDate) return;

    const key = `${selectedDate}|${method}`;
    let times = deliveryTimesByDate[key] || [];

    // —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ —Å–ª–æ—Ç—ã –∏ –ø–æ –º–∏–Ω. —á–∞—Å–∞–º
    times = filterDeliveryTimes(times);

    if (times.length === 0) {
        const option = document.createElement('option');
        option.value = "";
        option.textContent = "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏";
        option.disabled = true;
        deliveryTime.appendChild(option);

        

        return;
    }

    times.forEach(t => {
        const optionEl = document.createElement('option');
        optionEl.value = t;
        optionEl.textContent = t;
        deliveryTime.appendChild(optionEl);
    });
}

// ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–ò –°–ú–ï–ù–ï –ú–ï–¢–û–î–ê =====
methodSelect?.addEventListener('change', updateDeliveryTimes);

// ===== –ó–ê–ì–†–£–ó–ö–ê –ü–†–ò –°–¢–ê–†–¢–ï =====
Promise.all([loadMinHours(), loadDeliveryTimes()]);







let selectedDate = null;
let blockedDates = new Set();
let blockedWeekday = false;
let blockedWeekend = false;

// ===== –ó–ê–ì–†–£–ó–ö–ê GOOGLE SHEET =====
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRU16G77uq0XR1rGplEVVqn5-049-uhe-ycWu0DdNktVUOXvgfCMuV2pJwU-XPR8xLLCNdwOgh4q1Zs/pub?gid=425843351&single=true&output=csv";

async function loadBlockedDates() {
  try {
    const res = await fetch(sheetUrl);
    const csv = await res.text();
    const lines = csv.split("\n").map(l => l.trim());
    for(let i = 1; i < lines.length; i++){
      if(!lines[i]) continue;
      const [date, weekday, weekend] = lines[i].split(",");
      if(date) blockedDates.add(date.trim());
      if(weekday && weekday.trim().toUpperCase() === "YES") blockedWeekday = true;
      if(weekend && weekend.trim().toUpperCase() === "YES") blockedWeekend = true;
    }
  } catch(err) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Google Sheet", err);
  }
}


function updateDeliveryFields() {
  const method = methodSelect.value?.toLowerCase();

  if(method === "–¥–æ—Å—Ç–∞–≤–∫–∞" || method === "—Å–∞–º–æ–≤—ã–≤–æ–∑"){
    deliveryFields.style.display = "block";

    if(method === "–¥–æ—Å—Ç–∞–≤–∫–∞"){
      deliveryNote.style.display = "block";        
      deliveryAddress.style.display = "block";     
    } else { 
      deliveryNote.style.display = "none";         
      deliveryAddress.style.display = "none";      
    }

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –ø—Ä–∏ —Å–º–µ–Ω–µ –º–µ—Ç–æ–¥–∞
    selectedDate = null;
    chooseDateBtn.textContent = method === "–¥–æ—Å—Ç–∞–≤–∫–∞" ? "–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É *" : "–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É *";
    deliveryTime.innerHTML = "";
  } else {
    deliveryFields.style.display = "none";
    deliveryCalendar.style.display = "none";
    selectedDate = null;
    chooseDateBtn.textContent = "–í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É";
    deliveryTime.innerHTML = "";
  }
}

// –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ select
methodSelect?.addEventListener('change', () => {
  updateDeliveryFields();
  renderCalendar();       // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å
  updateDeliveryTimes();  // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
});

// –≤—ã–∑–æ–≤–µ–º –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø–æ–ª—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
updateDeliveryFields();


// ===== –û–¢–ö–†–´–¢–ò–ï –ö–ê–õ–ï–ù–î–ê–†–Ø =====
chooseDateBtn?.addEventListener('click', () => {
  deliveryCalendar.style.display = "block";
  renderCalendar();
});

// ===== –†–ï–ù–î–ï–† –ö–ê–õ–ï–ù–î–ê–†–Ø =====
function renderCalendar() {
  deliveryCalendar.innerHTML = '';
  const today = new Date();
  const maxDate = new Date();
  maxDate.setDate(today.getDate() + 6);

  const dates = [];
  const current = new Date(today.getFullYear(), today.getMonth(), today.getDate());
  while(current <= maxDate){
    dates.push(new Date(current));
    current.setDate(current.getDate() + 1);
  }

  const months = {};
  dates.forEach(d => {
    const key = d.getFullYear() + '-' + (d.getMonth()+1);
    if(!months[key]) months[key] = [];
    months[key].push(d);
  });

  for(const [key, monthDates] of Object.entries(months)){
    const monthLabel = document.createElement('div');
    monthLabel.className = 'month-label';
    monthLabel.textContent = monthDates[0].toLocaleString('default', { month: 'long', year: 'numeric' });
    monthLabel.style.marginTop = "20px";
    deliveryCalendar.appendChild(monthLabel);

    const daysContainer = document.createElement('div');
    daysContainer.className = 'days';

    const firstDate = new Date(monthDates[0].getFullYear(), monthDates[0].getMonth(), 1);
    const lastDate = new Date(monthDates[0].getFullYear(), monthDates[0].getMonth() + 1, 0);

    const startDay = (firstDate.getDay() + 6) % 7;
    for(let i=0; i<startDay; i++){
      const emptyDiv = document.createElement('div');
      daysContainer.appendChild(emptyDiv);
    }

    for(let day=1; day<=lastDate.getDate(); day++){
      const date = new Date(firstDate.getFullYear(), firstDate.getMonth(), day);
      const dayDiv = document.createElement('div');
      dayDiv.className = 'day';
      dayDiv.textContent = day;

      const isoDate = `${date.getFullYear()}-${(date.getMonth()+1).toString().padStart(2,'0')}-${date.getDate().toString().padStart(2,'0')}`;
      dayDiv.dataset.date = isoDate;

      // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ Google Sheets
      const isWeekend = (date.getDay() === 0 || date.getDay() === 6);
      const isWeekday = (date.getDay() >= 1 && date.getDay() <= 5);

      if(dates.some(d => d.getDate()===date.getDate() && d.getMonth()===date.getMonth() && d.getFullYear()===date.getFullYear())){
        dayDiv.classList.add('available');
        if(blockedDates.has(`${date.getDate().toString().padStart(2,'0')}.${(date.getMonth()+1).toString().padStart(2,'0')}.${date.getFullYear()}`) ||
           (blockedWeekend && isWeekend) ||
           (blockedWeekday && isWeekday)){
          dayDiv.classList.remove('available');
          dayDiv.classList.add('unavailable');
        }
      } else {
        dayDiv.classList.add('unavailable');
      }

      if(selectedDate === isoDate){
        dayDiv.classList.add('selected');
      }

      dayDiv.addEventListener('click', () => {
    if(dayDiv.classList.contains('unavailable')) return;

    const [year, month, day] = isoDate.split('-').map(Number);

    // selectedDate –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–¥.–º–º.–≥–≥–≥–≥
    selectedDate = `${day.toString().padStart(2,'0')}.${month.toString().padStart(2,'0')}.${year}`;

    chooseDateBtn.textContent = "–î–∞—Ç–∞: " + selectedDate;
    deliveryCalendar.style.display = "none";

    renderCalendar();
    updateDeliveryTimes(); // —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã
});


      daysContainer.appendChild(dayDiv);
    }

    deliveryCalendar.appendChild(daysContainer);
  }
}

// ===== –ó–ê–ì–†–£–ó–ö–ê –ë–õ–û–ö–ò–†–û–í–û–ö –ò –°–¢–ê–†–¢–û–í–´–ô –†–ï–ù–î–ï–† =====
loadBlockedDates().then(() => renderCalendar());










  let delivery = subtotal >= FREE_DELIVERY_LIMIT ? 0 : DELIVERY_COST;
  const method = checkoutForm?.method?.value?.toLowerCase();
    if (method === "—Å–∞–º–æ–≤—ã–≤–æ–∑") delivery = 0;

    let discount = 0;

  if (activePromo) {
    switch (activePromo.type) {
      case 'cart_discount':
        discount = (subtotal + delivery) * (activePromo.value / 100);
        break;

      case 'flat_discount':
        discount = activePromo.value;
        break;

      case 'min_total_discount':
        if (subtotal >= activePromo.min) discount = activePromo.value;
        break;

      case 'free_delivery':
        delivery = 0;
        break;
    }
  }


// ===== –°–ö–ò–î–ö–ê (–ü–û–ö–ê–ó–´–í–ê–ï–ú –¢–û–õ–¨–ö–û –ï–°–õ–ò –ï–°–¢–¨) =====
const discountRow = discountEl.parentElement;

if (
  (activePromo && activePromo.type === "free_item") ||
  discount > 0
) {
  discountRow.style.display = '';
  discountEl.textContent =
    activePromo?.type === "free_item"
      ? "–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è"
      : "-" + discount.toFixed(2) + " ‚Ç¨";
} else {
  discountRow.style.display = 'none';
}

  const total = subtotal + delivery - discount;
  subtotalEl.textContent = subtotal.toFixed(2) + " ‚Ç¨";
  deliveryEl.textContent = delivery.toFixed(2) + " ‚Ç¨";
    totalEl.textContent = total.toFixed(2) + " ‚Ç¨";

  // –ó–Ω–∞—á–æ–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
  if (cartCountEl) {
    let cnt = 0;
    cart.forEach(i => cnt += i.qty);
    cartCountEl.textContent = cnt;
  }
  saveCart();
  savePromo();
  updateDeliveryTimes();
}


// ===== –ò–ù–ò–¶–ò–ê–õ–¨–ù–´–ô –†–ï–ù–î–ï–† =====
loadCart();
loadPromo();

// ===== –ê–í–¢–û–†–ê–°–ö–†–´–¢–ò–ï –ü–†–û–ú–û–ë–õ–û–ö–ê –ü–†–ò –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ï =====
if (localStorage.getItem('activePromo')) {
    promoBox.style.display = 'block';
    showPromoBtn.style.display = 'none';
}


document.addEventListener('DOMContentLoaded', () => {
  const checkoutForm = document.getElementById('checkoutForm');
  const placeOrderBtn = document.getElementById('placeOrder');
  const paymentSelect = checkoutForm?.querySelector('[name="payment"]');

  if (!checkoutForm || !placeOrderBtn || !paymentSelect) return;

  function updateButton() {
    if (paymentSelect.value === '–ö–∞—Ä—Ç–∞ –æ–Ω–ª–∞–π–Ω') {
      placeOrderBtn.textContent = '–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ';
    } else {
      placeOrderBtn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑';
    }
  }

  paymentSelect.addEventListener('change', updateButton);
  updateButton(); // –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
});

const langBtns = document.querySelectorAll('.lang-switcher .lang-btn');
let currentLang = 'ru';

langBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    currentLang = btn.dataset.lang;
    langBtns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    updateTexts(); // —Ñ—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫
  });
});


updateCartUI();

</script>
</body>
</html>